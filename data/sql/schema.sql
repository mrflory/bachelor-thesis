CREATE TABLE auction (id BIGINT AUTO_INCREMENT, session_id BIGINT NOT NULL, name VARCHAR(255) NOT NULL, start_time DATETIME, show_bidders TINYINT(1) DEFAULT '1' NOT NULL, show_bidbutton TINYINT(1) DEFAULT '1' NOT NULL, bot_behaviour VARCHAR(255) DEFAULT 'off', bid_countraise BIGINT DEFAULT 20 NOT NULL, bid_raise_start BIGINT DEFAULT 20, bid_raise_limit BIGINT DEFAULT 20, bid_priceraise DECIMAL(10, 2) DEFAULT 1 NOT NULL, price DECIMAL(10, 2) DEFAULT 0 NOT NULL, countdown BIGINT DEFAULT 60 NOT NULL, show_directbuy TINYINT(1) DEFAULT '0' NOT NULL, direct_price DECIMAL(10, 2), description TEXT, image VARCHAR(255), valuation DECIMAL(10, 2) DEFAULT 100 NOT NULL, bid_fee DECIMAL(10, 2) DEFAULT 0.1 NOT NULL, current_price DECIMAL(10, 2), time_remaining BIGINT, money_spent DECIMAL(10, 2), last_bid DATETIME, bidder_id BIGINT, end_time DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX place_bid_idx (id, end_time, current_price), INDEX active_idx (session_id, end_time, start_time), INDEX session_id_idx (session_id), INDEX bidder_id_idx (bidder_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE bid (id BIGINT AUTO_INCREMENT, auction_id BIGINT NOT NULL, bidder_id BIGINT, bot_id BIGINT, price DECIMAL(10, 2) NOT NULL, countdown BIGINT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX auct_bidd_idx (auction_id, bidder_id), INDEX auction_id_idx (auction_id), INDEX bidder_id_idx (bidder_id), INDEX bot_id_idx (bot_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE bidder (id BIGINT AUTO_INCREMENT, auction_id BIGINT NOT NULL, participant_id BIGINT NOT NULL, valuation DECIMAL(10, 2), bid_fee DECIMAL(10, 2), money_spent DECIMAL(10, 2) DEFAULT 0 NOT NULL, bot_active TINYINT(1) DEFAULT '0' NOT NULL, direct_buy DECIMAL(10, 2), direct_count BIGINT, direct_price DECIMAL(10, 2), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX auct_part_idx (auction_id, participant_id), INDEX auction_id_idx (auction_id), INDEX participant_id_idx (participant_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE bot (id BIGINT AUTO_INCREMENT, auction_id BIGINT NOT NULL, bidder_id BIGINT, active TINYINT(1) DEFAULT '0' NOT NULL, init_numbids BIGINT NOT NULL, start DECIMAL(10, 2) NOT NULL, end DECIMAL(10, 2) NOT NULL, price DECIMAL(10, 2) NOT NULL, countdown BIGINT NOT NULL, numbids BIGINT, last_use DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX active_idx (bidder_id, active, auction_id, numbids, end, start), INDEX auction_id_idx (auction_id), INDEX bidder_id_idx (bidder_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE participant (id BIGINT AUTO_INCREMENT, session_id BIGINT NOT NULL, ip VARCHAR(32) UNIQUE, name VARCHAR(255) NOT NULL, init_money DECIMAL(10, 2) NOT NULL, money DECIMAL(10, 2), earned_money DECIMAL(10, 2) DEFAULT 0 NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX free_lock_idx (session_id, ip), INDEX session_id_idx (session_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE session (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, currency VARCHAR(255), active TINYINT(1) DEFAULT '0' NOT NULL, comment TEXT, message TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX active_idx (active), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE auction ADD CONSTRAINT auction_session_id_session_id FOREIGN KEY (session_id) REFERENCES session(id);
ALTER TABLE auction ADD CONSTRAINT auction_bidder_id_bidder_id FOREIGN KEY (bidder_id) REFERENCES bidder(id);
ALTER TABLE bid ADD CONSTRAINT bid_bot_id_bot_id FOREIGN KEY (bot_id) REFERENCES bot(id);
ALTER TABLE bid ADD CONSTRAINT bid_bidder_id_bidder_id FOREIGN KEY (bidder_id) REFERENCES bidder(id);
ALTER TABLE bid ADD CONSTRAINT bid_auction_id_auction_id FOREIGN KEY (auction_id) REFERENCES auction(id);
ALTER TABLE bidder ADD CONSTRAINT bidder_participant_id_participant_id FOREIGN KEY (participant_id) REFERENCES participant(id);
ALTER TABLE bidder ADD CONSTRAINT bidder_auction_id_auction_id FOREIGN KEY (auction_id) REFERENCES auction(id);
ALTER TABLE bot ADD CONSTRAINT bot_bidder_id_bidder_id FOREIGN KEY (bidder_id) REFERENCES bidder(id);
ALTER TABLE bot ADD CONSTRAINT bot_auction_id_auction_id FOREIGN KEY (auction_id) REFERENCES auction(id);
ALTER TABLE participant ADD CONSTRAINT participant_session_id_session_id FOREIGN KEY (session_id) REFERENCES session(id);
